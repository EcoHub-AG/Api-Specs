# © 2025 EcoHub AG. All rights reserved.
# Publicly accessible for informational purposes only.
# No rights to use, implement, modify, reproduce, distribute, or create derivative works without prior written authorization.
# Swiss law applies. Jurisdiction: Zurich.

asyncapi: 3.0.0
id: 'https://www.myecohub.ch'
info:
  title: 'Standard API Framework: Message Broker System'
  version: 1.1.0
  x-ecohub-license: >
    © 2025 EcoHub AG. Usage restricted. Prior written authorization required. Swiss law applies.
  contact:
    email: support@myecohub.ch
    name: EcoHub AG
    url: 'https://www.myecohub.ch'
  description: >
    API to connect to the SAF Kafka cluster using the kafka native protocol.
    
    ### Changes in Version 1.1.0
      - Improved documentation
      - increased max.message.bytes to 8388608 bytes (8MB) for all topics
      - ProcessNameType
        - renamed the enum values for proxy standards. These values were not yet supported by the platform and could not be used yet, therefore this change is treated as MINOR, not MAJOR.
        - added enum values for remaining legacy standards
      - SubProcessNameType
        - renamed the enum values for proxy standards. These values were not yet supported by the platform and could not be used yet, therefore this change is treated as MINOR, not MAJOR.
        - added enum values for remaining legacy standards
      - added operation to consume commission topic
      - added operation to consume invoice topic
      - added operation to consume contract topic
      - added operation to consume mandate topic
      - added operation to consume claimsExperience topic
    
    *changes in previous versions are available in the changelog file in GitHub*

servers:
  ecohub-iat-saf-server:
    host: saf.test-myecohub.ch:9092
    protocol: kafka-secure
    description: EcoHub IAT SAF broker
    bindings:
      kafka:
        schemaRegistryUrl: "https://services.test-myecohub.ch/schemaregistry"
        schemaRegistryVendor: "confluent"
    security:
      - $ref: '#/components/securitySchemes/X509'
  ecohub-prod-saf-server:
    host: saf.myecohub.ch:9092
    protocol: kafka-secure
    description: EcoHub Prod SAF broker
    bindings:
      kafka:
        schemaRegistryUrl: "https://services.myecohub.ch/schemaregistry"
        schemaRegistryVendor: "confluent"
    security:
      - $ref: '#/components/securitySchemes/X509'
defaultContentType: application/json
channels:
  eh.saf.in.v1:
    address: eh.saf.in.v1
    bindings:
      kafka:
        topic: 'eh.saf.in.v1'
        partitions: 9
        replicas: 2
        topicConfiguration:
          cleanup.policy: [ "delete" ]
          retention.ms: 604800000
          retention.bytes: -1
          delete.retention.ms: 86400000
          max.message.bytes: 8338608
        bindingVersion: '0.4.0'
    messages:
      produceSAFEvent:
        $ref: '#/components/messages/safEvent'
      produceSAFInquiryEvent:
        $ref: '#/components/messages/safInquiryEvent'
      safErrorEvent:
        $ref: '#/components/messages/safErrorEvent'
      offerNlpiErrorEvent:
        $ref: '#/components/messages/offerNlpiErrorEvent'
  eh.saf.offer.out.v1:
    address: eh.saf.{ecohubId}.offer.nlpi.out.v1
    bindings:
      kafka:
        topic: 'eh.saf.{ecohubId}.offer.nlpi.out.v1'
        partitions: 3
        replicas: 2
        topicConfiguration:
          cleanup.policy: [ "delete" ]
          retention.ms: 604800000
          retention.bytes: -1
          delete.retention.ms: 86400000
          max.message.bytes: 8388608
        bindingVersion: '0.4.0'
    parameters:
      ecohubId:
        description: "The EcoHubId can be looked up in EcoHub on the SAF TechUser page. Check the kafka topic
          names, which follow the pattern 'eh.saf.{ecohubId}.{standard}.out.{version}'."
    messages:
      consumeSAFEvent:
        $ref: '#/components/messages/safEvent'
      consumeSAFInquiryEvent:
        $ref: '#/components/messages/safInquiryEvent'
      safErrorEvent:
        $ref: '#/components/messages/safErrorEvent'
      offerNlpiErrorEvent:
        $ref: '#/components/messages/offerNlpiErrorEvent'
  eh.saf.commission.out.v1:
    address: eh.saf.{ecohubId}.commission.out.v1
    bindings:
      kafka:
        topic: 'eh.saf.{ecohubId}.commission.out.v1'
        partitions: 3
        replicas: 2
        topicConfiguration:
          cleanup.policy: [ "delete" ]
          retention.ms: 604800000
          retention.bytes: -1
          delete.retention.ms: 86400000
          max.message.bytes: 8388608
        bindingVersion: '0.4.0'
    parameters:
      ecohubId:
        description: "The EcoHubId can be looked up in EcoHub on the SAF TechUser page. Check the kafka topic
          names, which follow the pattern 'eh.saf.{ecohubId}.{standard}.out.{version}'."
    messages:
      consumeSAFEvent:
        $ref: '#/components/messages/safEvent'
      consumeSAFInquiryEvent:
        $ref: '#/components/messages/safInquiryEvent'
      safErrorEvent:
        $ref: '#/components/messages/safErrorEvent'
  eh.saf.invoice.out.v1:
    address: eh.saf.{ecohubId}.invoice.out.v1
    bindings:
      kafka:
        topic: 'eh.saf.{ecohubId}.invoice.out.v1'
        partitions: 3
        replicas: 2
        topicConfiguration:
          cleanup.policy: [ "delete" ]
          retention.ms: 604800000
          retention.bytes: -1
          delete.retention.ms: 86400000
          max.message.bytes: 8388608
        bindingVersion: '0.4.0'
    parameters:
      ecohubId:
        description: "The EcoHubId can be looked up in EcoHub on the SAF TechUser page. Check the kafka topic
          names, which follow the pattern 'eh.saf.{ecohubId}.{standard}.out.{version}'."
    messages:
      consumeSAFEvent:
        $ref: '#/components/messages/safEvent'
      consumeSAFInquiryEvent:
        $ref: '#/components/messages/safInquiryEvent'
      safErrorEvent:
        $ref: '#/components/messages/safErrorEvent'
  eh.saf.contract.out.v1:
    address: eh.saf.{ecohubId}.contract.out.v1
    bindings:
      kafka:
        topic: 'eh.saf.{ecohubId}.contract.out.v1'
        partitions: 3
        replicas: 2
        topicConfiguration:
          cleanup.policy: [ "delete" ]
          retention.ms: 604800000
          retention.bytes: -1
          delete.retention.ms: 86400000
          max.message.bytes: 8388608
        bindingVersion: '0.4.0'
    parameters:
      ecohubId:
        description: "The EcoHubId can be looked up in EcoHub on the SAF TechUser page. Check the kafka topic
          names, which follow the pattern 'eh.saf.{ecohubId}.{standard}.out.{version}'."
    messages:
      consumeSAFEvent:
        $ref: '#/components/messages/safEvent'
      consumeSAFInquiryEvent:
        $ref: '#/components/messages/safInquiryEvent'
      safErrorEvent:
        $ref: '#/components/messages/safErrorEvent'
  eh.saf.mandate.out.v1:
    address: eh.saf.{ecohubId}.mandate.out.v1
    bindings:
      kafka:
        topic: 'eh.saf.{ecohubId}.mandate.out.v1'
        partitions: 3
        replicas: 2
        topicConfiguration:
          cleanup.policy: [ "delete" ]
          retention.ms: 604800000
          retention.bytes: -1
          delete.retention.ms: 86400000
          max.message.bytes: 8388608
        bindingVersion: '0.4.0'
    parameters:
      ecohubId:
        description: "The EcoHubId can be looked up in EcoHub on the SAF TechUser page. Check the kafka topic
          names, which follow the pattern 'eh.saf.{ecohubId}.{standard}.out.{version}'."
    messages:
      consumeSAFEvent:
        $ref: '#/components/messages/safEvent'
      consumeSAFInquiryEvent:
        $ref: '#/components/messages/safInquiryEvent'
      safErrorEvent:
        $ref: '#/components/messages/safErrorEvent'
  eh.saf.claimsExperience.out.v1:
    address: eh.saf.{ecohubId}.claimsExperience.out.v1
    bindings:
      kafka:
        topic: 'eh.saf.{ecohubId}.claimsExperience.out.v1'
        partitions: 3
        replicas: 2
        topicConfiguration:
          cleanup.policy: [ "delete" ]
          retention.ms: 604800000
          retention.bytes: -1
          delete.retention.ms: 86400000
          max.message.bytes: 8388608
        bindingVersion: '0.4.0'
    parameters:
      ecohubId:
        description: "The EcoHubId can be looked up in EcoHub on the SAF TechUser page. Check the kafka topic
          names, which follow the pattern 'eh.saf.{ecohubId}.{standard}.out.{version}'."
    messages:
      consumeSAFEvent:
        $ref: '#/components/messages/safEvent'
      consumeSAFInquiryEvent:
        $ref: '#/components/messages/safInquiryEvent'
      safErrorEvent:
        $ref: '#/components/messages/safErrorEvent'
operations:
  produceSAFEvent:
    action: send
    channel:
      $ref: "#/channels/eh.saf.in.v1"
  consumeOfferEvent:
    action: receive
    bindings:
      kafka:
        groupId:
          type: string
          pattern: ^CG-(\d{5,6})-IDP(\d{6})$
        clientId:
          type: string
          format: uuid
        bindingVersion: '0.4.0'
    channel:
      $ref: "#/channels/eh.saf.offer.out.v1"
  consumeCommissionEvent:
    action: receive
    bindings:
      kafka:
        groupId:
          type: string
          pattern: ^CG-(\d{5,6})-IDP(\d{6})$
        clientId:
          type: string
          format: uuid
        bindingVersion: '0.4.0'
    channel:
      $ref: "#/channels/eh.saf.commission.out.v1"
  consumeInvoiceEvent:
    action: receive
    bindings:
      kafka:
        groupId:
          type: string
          pattern: ^CG-(\d{5,6})-IDP(\d{6})$
        clientId:
          type: string
          format: uuid
        bindingVersion: '0.4.0'
    channel:
      $ref: "#/channels/eh.saf.invoice.out.v1"
  consumeContractEvent:
    action: receive
    bindings:
      kafka:
        groupId:
          type: string
          pattern: ^CG-(\d{5,6})-IDP(\d{6})$
        clientId:
          type: string
          format: uuid
        bindingVersion: '0.4.0'
    channel:
      $ref: "#/channels/eh.saf.contract.out.v1"
  consumeMandateEvent:
    action: receive
    bindings:
      kafka:
        groupId:
          type: string
          pattern: ^CG-(\d{5,6})-IDP(\d{6})$
        clientId:
          type: string
          format: uuid
        bindingVersion: '0.4.0'
    channel:
      $ref: "#/channels/eh.saf.mandate.out.v1"
  consumeClaimsExperienceEvent:
    action: receive
    bindings:
      kafka:
        groupId:
          type: string
          pattern: ^CG-(\d{5,6})-IDP(\d{6})$
        clientId:
          type: string
          format: uuid
        bindingVersion: '0.4.0'
    channel:
      $ref: "#/channels/eh.saf.claimsExperience.out.v1"
components:
  securitySchemes:
    X509:
      type: X509
      description: Provide the techuser certificate for authentication
  schemas:
    SAFEventType:
      description: 'The main event type which can either be used to transmit business data according to a data standard or to send an acknowledge event.'
      type: object
      properties:
        id:
          $ref: '#/components/schemas/cloudEvents/iddef'
        source:
          $ref: '#/components/schemas/cloudEvents/sourcedef'
        specversion:
          $ref: '#/components/schemas/cloudEvents/specversiondef'
        type:
          $ref: '#/components/schemas/eventType'
        datacontenttype:
          $ref: '#/components/schemas/cloudEvents/datacontenttypedef'
        dataschema:
          $ref: '#/components/schemas/cloudEvents/dataschemadef'
        subject:
          $ref: '#/components/schemas/cloudEvents/subjectdef'
        time:
          $ref: '#/components/schemas/cloudEvents/timedef'
        licenceKey:
          $ref: '#/components/schemas/licenceKeyType'
        userAgent:
          $ref: '#/components/schemas/userAgentType'
        eventReceiver:
          $ref: '#/components/schemas/senderReceiverType'
        eventSender:
          $ref: '#/components/schemas/senderReceiverType'
        data:
          $ref: '#/components/schemas/eventDataType'
        processGroupId:
          $ref: '#/components/schemas/processGroupIdType'
        processId:
          $ref: '#/components/schemas/processIdType'
        processName:
          $ref: '#/components/schemas/processNameType'
        processVersion:
          $ref: '#/components/schemas/processVersionType'
        processStatus:
          $ref: '#/components/schemas/processStatusType'
        subProcessName:
          $ref: '#/components/schemas/subProcessNameType'
        subProcessStatus:
          $ref: '#/components/schemas/subProcessStatusType'
      additionalProperties: false
      required:
        - id
        - source
        - specversion
        - type
        - processId
        - processName
        - processVersion
        - subProcessName
        - processStatus
        - subProcessStatus
        - eventReceiver
        - eventSender
        - userAgent
        - licenceKey
    SAFInquiryEventType:
      $id: SAFInquiryEventType
      description: 'SAF inquiry event, i.e. an event containing a generic message.'
      type: object
      properties:
        id:
          $ref: '#/components/schemas/cloudEvents/iddef'
        source:
          $ref: '#/components/schemas/cloudEvents/sourcedef'
        specversion:
          $ref: '#/components/schemas/cloudEvents/specversiondef'
        datacontenttype:
          $ref: '#/components/schemas/cloudEvents/datacontenttypedef'
        dataschema:
          $ref: '#/components/schemas/cloudEvents/dataschemadef'
        subject:
          $ref: '#/components/schemas/cloudEvents/subjectdef'
        time:
          $ref: '#/components/schemas/cloudEvents/timedef'
        licenceKey:
          $ref: '#/components/schemas/licenceKeyType'
        userAgent:
          $ref: '#/components/schemas/userAgentType'
        type:
          $ref: '#/components/schemas/eventType'
        data:
          $ref: '#/components/schemas/eventMessageDataType'
        eventReceiver:
          $ref: "#/components/schemas/senderReceiverType"
        eventSender:
          $ref: "#/components/schemas/senderReceiverType"
        processGroupId:
          $ref: '#/components/schemas/processGroupIdType'
        processId:
          $ref: "#/components/schemas/processIdType"
        processName:
          $ref: "#/components/schemas/processNameType"
        processVersion:
          $ref: '#/components/schemas/processVersionType'
        processStatus:
          $ref: "#/components/schemas/processStatusType"
        subProcessName:
          $ref: "#/components/schemas/subProcessNameType"
        subProcessStatus:
          $ref: "#/components/schemas/subProcessStatusType"
      additionalProperties: false
      required:
        - id
        - source
        - specversion
        - type
        - processId
        - processName
        - processVersion
        - subProcessName
        - processStatus
        - subProcessStatus
        - eventReceiver
        - eventSender
        - userAgent
        - licenceKey
    SAFErrorEventType:
      $id: SAFErrorEventType
      description: SAF error event, i.e. an event for errors which are unrelated to the event payload.
      type: object
      properties:
        id:
          $ref: '#/components/schemas/cloudEvents/iddef'
        source:
          $ref: '#/components/schemas/cloudEvents/sourcedef'
        specversion:
          $ref: '#/components/schemas/cloudEvents/specversiondef'
        datacontenttype:
          $ref: '#/components/schemas/cloudEvents/datacontenttypedef'
        dataschema:
          $ref: '#/components/schemas/cloudEvents/dataschemadef'
        subject:
          $ref: '#/components/schemas/cloudEvents/subjectdef'
        time:
          $ref: '#/components/schemas/cloudEvents/timedef'
        licenceKey:
          $ref: '#/components/schemas/licenceKeyType'
        userAgent:
          $ref: '#/components/schemas/userAgentType'
        type:
          $ref: '#/components/schemas/eventType'
        data:
          $ref: "#/components/schemas/errorDataType"
        eventReceiver:
          $ref: "#/components/schemas/senderReceiverType"
        eventSender:
          $ref: "#/components/schemas/senderReceiverType"
        processGroupId:
          $ref: '#/components/schemas/processGroupIdType'
        processId:
          $ref: "#/components/schemas/processIdType"
        processName:
          $ref: "#/components/schemas/processNameType"
        processVersion:
          $ref: '#/components/schemas/processVersionType'
        processStatus:
          $ref: "#/components/schemas/processStatusType"
        subProcessName:
          $ref: "#/components/schemas/subProcessNameType"
        subProcessStatus:
          $ref: "#/components/schemas/subProcessStatusType"
      required:
        - id
        - source
        - specversion
        - type
        - processId
        - processName
        - processVersion
        - subProcessName
        - processStatus
        - subProcessStatus
        - eventReceiver
        - eventSender
        - userAgent
        - licenceKey
      additionalProperties: false
    OfferNLPIErrorEventType:
      description: Offer NLPI error event, i.e. an event for errors which related to the event payload.
      type: object
      properties:
        id:
          $ref: '#/components/schemas/cloudEvents/iddef'
        source:
          $ref: '#/components/schemas/cloudEvents/sourcedef'
        specversion:
          $ref: '#/components/schemas/cloudEvents/specversiondef'
        type:
          $ref: '#/components/schemas/eventType'
        datacontenttype:
          $ref: '#/components/schemas/cloudEvents/datacontenttypedef'
        dataschema:
          $ref: '#/components/schemas/cloudEvents/dataschemadef'
        subject:
          $ref: '#/components/schemas/cloudEvents/subjectdef'
        time:
          $ref: '#/components/schemas/cloudEvents/timedef'
        licenceKey:
          $ref: '#/components/schemas/licenceKeyType'
        userAgent:
          $ref: '#/components/schemas/userAgentType'
        data:
          $ref: "#/components/schemas/offerNLPIErrorType"
        eventReceiver:
          $ref: "#/components/schemas/senderReceiverType"
        eventSender:
          $ref: "#/components/schemas/senderReceiverType"
        processGroupId:
          $ref: '#/components/schemas/processGroupIdType'
        processId:
          $ref: "#/components/schemas/processIdType"
        processName:
          $ref: "#/components/schemas/processNameType"
        processVersion:
          $ref: '#/components/schemas/processVersionType'
        processStatus:
          $ref: "#/components/schemas/processStatusType"
        subProcessName:
          $ref: "#/components/schemas/subProcessNameType"
        subProcessStatus:
          $ref: "#/components/schemas/subProcessStatusType"
      required:
        - id
        - source
        - specversion
        - type
        - data
        - processId
        - processName
        - processVersion
        - subProcessName
        - processStatus
        - subProcessStatus
        - eventReceiver
        - eventSender
        - userAgent
        - licenceKey
      additionalProperties: false
    offerNLPIErrorType:
      type: array
      minItems: 1
      items:
        $id: offerNLPIErrorItemType
        type: object
        properties:
          errorCode:
            $id: OfferNLPIErrorCodeEnum
            description: The code best describing the occured error.
            minLength: 3
            type: string
            enum:
              - other
          errorMessage:
            description: Error message
            minLength: 3
            type: string
          path:
            description: xPath or JsonPath to the property where the error occurred.
            type: string
        additionalProperties: false
        required:
          - errorCode
          - errorMessage
    processNameType:
      description: Identifier of the core process
      type: string
      enum:
        - offer.nlpi
        - invoice
        - commission
        - contract
        - mandate
        - claimsExperience
    processVersionType:
      description: Version of the used core process
      type: string
      pattern: "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
    eventType:
      description: 'Reverse DNS entry to defines the type of event: data, inquiry, standard-error
        or saf-error'
      minLength: 1
      type: string
      enum:
        - ch.ecohub.saf.data
        - ch.ecohub.saf.inquiry
        - ch.ecohub.saf.standard-error
        - ch.ecohub.saf.saf-error
    eventMessageDataType:
      description: The message transmitted with the event and relevant attributes for signing
        and encryption.
      type: object
      properties:
        encryptionKey:
          description: The encrypted AES key, which was used to symmetrically encrypt the
            transmitted message. The key must be encrypted with the public key of the eventReceiver
            using RSA with OAEP padding with a SHA256 hash.
          minLength: 3
          type: string
        messageSignature:
          description: A digital signature used to verify the origin of the encrypted message.
            The signature is created by signing the content of the payload attribute using
            the elliptic curve algorithm secp384r1 with a SHA-384 hash, and your active
            signature key. The resulting signature must be ASN.1 encoded and transmitted
            in Base64.
          minLength: 3
          type: string
        message:
          description: The base64 representation of the first g-zipped and then encrypted
            original message. For encryption, the AES-GCM algorithm with a 256-bit key,
            a 96-bit initialization vector (IV), and a 128-bit authentication tag must be
            used.
          minLength: 3
          type: string
        publicKeyVersion:
          description: The version of the receiver's public key that was used to encrypt
            the encryptionKey.
          type: string
        signatureKeyVersion:
          description: The version of your signature key, that was used to sign the message.
          type: string
      required:
        - message
        - messageSignature
        - encryptionKey
        - publicKeyVersion
        - signatureKeyVersion
      additionalProperties: false
    errorDataType:
      description: The error event payload.
      type: object
      properties:
        errorCode:
          $id: SafErrorCodeEnum
          description: 'Categorizes the type of error'
          type: string
          minLength: 3
          enum:
            - licenseKey-not-valid
            - sa-not-found
            - receiver-not-found
            - event-not-valid
            - pk-version-not-found
            - data-content-invalid
            - data-schema-invalid
            - data-not-readable
            - data-decryption-failed
            - data-decompression-failed
            - other
        errorMessage:
          description: ""
          type: string
          minLength: 3
        errorDateTime:
          description: ""
          type: string
          format: date-time
      required:
        - errorCode
        - errorMessage
        - errorDateTime
    subProcessNameType:
      description: Identifier for the current subprocess / process step within the core
        process.
      type: string
      enum:
        - request
        - offer
        - feedback
        - conclusionDecision
        - billing
        - reminder
        - contract
        - commission
        - submission
        - cancellation
        - claimsExperience
      example: request
    subProcessStatusType:
      type: string
      enum:
        - Created
        - Received
        - InProgress
        - Responded
        - Updated
        - Error
        - Inquiry
        - Inquiry_Answer
        - Closed
    processStatusType:
      type: string
      enum:
        - active
        - closed
      description: Defines status of the overall process.
    processIdType:
      type: string
      format: UUID
      description: UUID, that won't change during the offer processes. The UUID is set by the party, that starts the process.
    senderReceiverType:
      type: object
      additionalProperties: false
      properties:
        category:
          $id: SenderReceiverCategoryEnum
          description: The category of the organisation
          enum:
            - broker
            - insurer
            - serviceprovider
          example: broker
          type: string
        id:
          description: The IDP number of the member's techUser. The IDP number of the eventReceiver
            can be determined through the /saf-receivers endpoint of the General API.
          examples:
            - IDP1239856
          minLength: 3
          type: string
        onBehalfBy:
          type: string
          description: The IDP number of the software provider's techUser if the event is
            send on behalf.
          pattern: "^IDP(\\d{7})$"
      required:
        - category
        - id
    eventDataType:
      description: The data transmitted with the event and relevant attributes for signing
        and encryption.
      type: object
      properties:
        payload:
          description: The base64 representation of the first g-zipped and then encrypted
            original payload. For encryption, the AES-GCM algorithm with a 256-bit key,
            a 96-bit initialization vector (IV), and a 128-bit authentication tag must be
            used.
          minLength: 3
          type: string
        payloadSignature:
          description: A digital signature used to verify the origin of the encrypted payload.
            The signature is created by signing the content of the payload attribute using
            the elliptic curve algorithm secp384r1 with a SHA-384 hash, and your active
            signature key. The resulting signature must be ASN.1 encoded and transmitted
            in Base64.
          minLength: 3
          type: string
        links:
          items:
            $id: LinkType
            type: object
            properties:
              description:
                description: Description of the purpose of the link
                type: string
              href:
                description: the- encrypted URL that should be called, to receive additional
                  encrypted unstructured data, such as pdf, pictures, etc.
                example: https://services.test-myecohub.ch/offer/nlpi/{offerId}/{attachmentId}
                  (unencrypted example)
                minLength: 3
                type: string
              rel:
                description: The IG B2B Standard the links belongs to.
                example: offer-nlpi
                minLength: 3
                type: string
            required:
              - href
              - rel
            additionalProperties: false
          type: array
          minItems: 1
        encryptionKey:
          description: The encrypted AES key, which was used to symmetrically encrypt the
            transmitted data. The key must be encrypted with the public key of the eventReceiver
            using RSA with OAEP padding with a SHA256 hash.
          minLength: 3
          type: string
        publicKeyVersion:
          description: The version of the receiver's public key that was used to encrypt
            the encryptionKey.
          type: string
        signatureKeyVersion:
          description: The version of your signature key, that was used to sign the payload.
          type: string
      required:
        - payload
        - payloadSignature
        - encryptionKey
        - publicKeyVersion
        - signatureKeyVersion
      additionalProperties: false
    cloudEvents:
      iddef:
        description: Identifies the event. Producers MUST ensure that source + id is unique
          for each distinct event. If a duplicate event is re-sent (e.g. due to a network
          error) it MAY have the same id. Consumers MAY assume that Events with identical
          source and id are duplicates.
        examples:
          - A234-1234-1234
        minLength: 1
        type: string
      sourcedef:
        description: Uniquely identifies the producer of the event. Must be globally unique,
          including across environments.
        examples:
          - http://www.myecohub.ch/iat/ecohub-processes
          - http://www.myecohub.ch/prod/ecohub-processes
        format: uri-reference
        minLength: 1
        type: string
      specversiondef:
        description: The version of the CloudEvents specification which the event uses. MUST
          be set to 1.0
        examples:
          - '1.0'
        minLength: 1
        type: string
      typedef:
        type: string
        minLength: 1
      datacontenttypedef:
        description: Content type of the data value. Must adhere to RFC 2046 format.
        examples:
          - text/xml
          - application/json
        minLength: 1
        type:
          - 'null'
          - string
      dataschemadef:
        description: Identifies the schema that data adheres to. Must point to the respective raw schema in
          the EcoHub GitHub schema repository (https://github.com/EcoHub-AG/Standards).
        format: uri
        minLength: 1
        type: string
        examples:
          - https://raw.githubusercontent.com/EcoHub-AG/Standards/refs/tags/Offer_NLPI_v0.3.0/schemas/Offer-NLPI/v0.3.0/offer-nlpi-root/OfferNlpiRequestDataType.json
          - https://raw.githubusercontent.com/EcoHub-AG/Standards/refs/tags/Offer_NLPI_v0.3.0/schemas/Offer-NLPI/v0.3.0/offer-nlpi-root/OfferNlpiDataType.json
      subjectdef:
        description: Describes the subject of the event to provide additional context about
          the event.
        examples:
          - Billing november 2024
          - MF offer company A
        minLength: 1
        type:
          - 'null'
          - string
      timedef:
        description: Timestamp of when the occurrence happened. Must adhere to RFC 3339.
        examples:
          - '2018-04-05T17:31:03.526Z'
        format: date-time
        minLength: 1
        type:
          - 'null'
          - string
    licenceKeyType:
      description: The license key for the requesting SC application.
      type: string
      maxLength: 200
      minLength: 3
      example: fdsaf346t54grthe65euz467jhz7r
    userAgentType:
      type: object
      description: Identifies the software that was used to produce the event
      properties:
        name:
          description: Name of the application
          example: Client software XYZ
          maxLength: 100
          minLength: 3
          type: string
        version:
          description: Used version of the application
          example: Version 1.0
          maxLength: 30
          minLength: 3
          type: string
      required:
        - name
        - version
      additionalProperties: false
    SAFKeyType:
      description: Format of the kafka message key
      type: object
      properties:
        processId:
          $ref: '#/components/schemas/processIdType'
      additionalProperties: false
      required:
        - processId
    processGroupIdType:
      description: UUID, that is used to associate multiple processes. The exact usage is
        specified in each data standard.
      type: string
      format: uuid
  messages:
    safEvent:
      name: safEvent
      title: SAF Event (Business Data or Acknowledge)
      summary: Event which either contains business data or is used to transmit an acknowledge message.
      payload:
        $ref: '#/components/schemas/SAFEventType'
      bindings:
        kafka:
          key:
            $ref: '#/components/schemas/SAFKeyType'
          schemaIdLocation: 'payload'
          schemaIdPayloadEncoding: 'confluent'
          bindingVersion: '0.4.0'
      examples:
        - name: eventWithPayloadExample
          summary: SAFEvent with offer.nlpi payload
          payload:
            id: 044d2e50-12d6-43e4-bb1b-7b54841c9c82
            source: http://www.myecohub.ch/ecoHub-mock-broker-producer1
            specversion: '1.0'
            type: ch.ecohub.saf.data
            datacontenttype: application/json
            dataschema: https://raw.githubusercontent.com/EcoHub-AG/Standards/refs/tags/Offer_NLPI_v0.3.0/schemas/Offer-NLPI/v0.3.0/offer-nlpi-root/OfferNlpiRequestDataType.json
            subject: offer nlpi request
            time: '2023-08-17T14:15:22.000Z'
            licenceKey: REcxZEVMZWV1UXFwOUZwaz...
            userAgent:
              name: BS1
              version: '1.0'
            eventReceiver:
              category: insurer
              id: IDP1234567
            eventSender:
              category: broker
              id: IDP7654321
            data:
              payload: V2UgZGlkbid0IGluY2x1ZGUgdGhlIGZ1bGwgcGF5bG9hZCBoZ...
              payloadSignature: MEYCIQD76gKbAynmvE5Ndq+Tnnf/aBziZlryXkP
              encryptionKey: urpx9D/0MwvQoCz3nNcQyMpEh2VEW6X7TiMmIfH...
              publicKeyVersion: '1.1'
              signatureKeyVersion: '1.3'
            processId: ff9275bf-5b35-492e-bdd2-c217e151d335
            processName: offer.nlpi
            processVersion: 0.3.0
            processStatus: active
            subProcessName: request
            subProcessStatus: Created
        - name: acknowledgeEventExample
          summary: Acknowledge Event
          payload:
            id: 044d2e50-12d6-43e4-bb1b-7b54841c9c82
            source: http://www.myecohub.ch/ecoHub-mock-broker-producer1
            specversion: '1.0'
            type: ch.ecohub.saf.data
            subject: offer nlpi request acknowledgement
            time: '2023-08-17T14:15:22.000Z'
            licenceKey: REcxZEVMZWV1UXFwOUZwaz...
            userAgent:
              name: BS1
              version: '1.0'
            eventReceiver:
              category: insurer
              id: IDP1234567
            eventSender:
              category: broker
              id: IDP7654321
            processId: ff9275bf-5b35-492e-bdd2-c217e151d335
            processName: offer.nlpi
            processVersion: 0.3.0
            processStatus: active
            subProcessName: request
            subProcessStatus: Received
    safInquiryEvent:
      name: safInquiryEvent
      title: SAF Inquiry Event
      summary: Events that are used to send a general purpose message
      bindings:
        kafka:
          key:
            $ref: '#/components/schemas/SAFKeyType'
          schemaIdLocation: 'payload'
          schemaIdPayloadEncoding: 'confluent'
          bindingVersion: '0.4.0'
      payload:
        $ref: '#/components/schemas/SAFInquiryEventType'
    safErrorEvent:
      name: safErrorEvent
      title: Technical SAF Error
      summary: Events that are used to send technical saf errors, i.e. errors that don't stem from the transmitted business data.
      payload:
        $ref: '#/components/schemas/SAFErrorEventType'
      bindings:
        kafka:
          key:
            $ref: '#/components/schemas/SAFKeyType'
          schemaIdLocation: 'payload'
          schemaIdPayloadEncoding: 'confluent'
          bindingVersion: '0.4.0'
    offerNlpiErrorEvent:
      name: offerNlpiErrorEvent
      title: Offer NLPI Business Error Event
      summary: Events that are used to send business errors, i.e. errors that are related to the transmitted business data.
      payload:
        $ref: '#/components/schemas/OfferNLPIErrorEventType'
      bindings:
        kafka:
          key:
            $ref: '#/components/schemas/SAFKeyType'
          schemaIdLocation: 'payload'
          schemaIdPayloadEncoding: 'confluent'
          bindingVersion: '0.4.0'
